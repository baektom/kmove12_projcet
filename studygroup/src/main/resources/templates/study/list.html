<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>전체보기 - STUDY MATE</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<header th:replace="~{layout/header :: header}"></header>

<main class="container" style="max-width:1000px; margin:0 auto; padding:20px;">
  <h2 style="margin:20px 0;">전체 스터디룸</h2>

  <form th:action="@{/studies}" method="get" style="display:flex; gap:10px; margin:20px 0;">
    <input type="text" name="q" th:value="${q}" placeholder="제목/키워드로 검색"
           style="flex:1; padding:12px 16px; border:2px solid #e9ecef; border-radius:10px;">
    <button type="submit"
            style="padding:12px 24px; border:none; border-radius:10px; background:#2b56f5; color:#fff; font-weight:700;">
      검색
    </button>
  </form>

  <div id="keyword-container" style="position: relative; margin-bottom: 5px;">
    <div id="keyword-list" style="display:flex; flex-wrap:wrap; gap:10px; height: 45px; overflow: hidden; transition: height 0.3s ease;">

      <a th:href="@{/studies(q=${q})}"
         th:style="'padding:8px 16px; border-radius:20px; text-decoration:none; font-weight:700; transition: 0.2s; ' +
                   (${selectedKeywordId == null} ? 'background:#e7f0ff; color:#2b56f5;' : 'background:#f1f3f5; color:#333;')">
        전체
      </a>

      <a th:each="k : ${keywordList}"
         th:href="@{/studies(keywordId=${k.id}, q=${q})}"
         th:text="${k.name}"
         th:style="'padding:8px 16px; border-radius:20px; text-decoration:none; font-weight:700; transition: 0.2s; ' +
                   (${selectedKeywordId != null && selectedKeywordId == k.id} ? 'background:#e7f0ff; color:#2b56f5;' : 'background:#f1f3f5; color:#333;')">
      </a>
    </div>

    <button id="toggle-btn" onclick="toggleKeywords()"
            style="margin-top: 10px; background: none; border: none; color: #666; cursor: pointer; font-weight: 700; display: flex; align-items: center; gap: 5px;">
      카테고리 더보기 <span id="arrow-icon">▼</span>
    </button>
  </div>

  <div style="display:flex; justify-content:flex-end; margin-top: -15px; margin-bottom: 20px;">
    <a th:href="@{/study/create}"
       style="padding:12px 20px; border-radius:30px; background:#28a745; color:#fff; text-decoration:none; font-weight:800; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
      + 스터디 만들기
    </a>
  </div>

  <div class="study-list" style="margin-top: 10px;">
    <div th:each="study : ${studyList}" class="study-item"
         th:onclick="|location.href='@{/study/{id}(id=${study.id})}'|">
      <a th:href="@{/study/{id}(id=${study.id})}"
         th:text="${study.title}"
         class="study-title">스터디 제목</a>

      <div class="study-info">
  <span class="status-badge"
        th:classappend="${study.status == '모집중'} ? 'status-recruiting' : 'status-closed'"
        th:text="${study.status.description}">모집중</span>

        <span>
    참여인원
    <span th:text="${study.currentParticipants}" style="color:#2b56f5; font-weight:bold;">0</span> /
    <span th:text="${study.maxParticipants}">5</span>
  </span>
        <span style="color:#666;">조회수 <b th:text="${study.viewCount}">0</b></span>
      </div>
    </div>

</main>

<script>
  function toggleKeywords() {
    const list = document.getElementById('keyword-list');
    const btn = document.getElementById('toggle-btn');
    if (list.style.height === '45px' || list.style.height === '') {
      list.style.height = 'auto';
      btn.innerHTML = '카테고리 접기 <span id="arrow-icon">▲</span>';
    } else {
      list.style.height = '45px';
      btn.innerHTML = '카테고리 더보기 <span id="arrow-icon">▼</span>';
    }
  }
</script>
</body>
</html>